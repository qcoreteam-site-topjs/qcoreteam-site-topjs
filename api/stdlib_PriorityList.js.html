<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>stdlib/PriorityList.js - A full-stack web framework for nodejs</title>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="../css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="../css/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="../css/extra.css">
    <link type="text/css" rel="stylesheet" href="../css/common.css">
    <link type="text/css" rel="stylesheet" href="../css/highlight.css">
</head>
<body>
<header class="navbar navbar-fixed-top fixed-header fixed-header-active header hidden-sm-down">
     <nav class="navbar-light">

        <div class="">
            <button class="navbar-toggler hidden-lg-up float-xs-right" type="button" data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"></button>
            <a href="/"><img class="navbar-brand logo" src="../images/logo-green.png"></a>

            <div class="collapse navbar-toggleable-md float-lg-right" id="navbarResponsive">
                <ul class="nav navbar-nav float-lg-right">
                    <li class="nav-item"><a class="nav-link" href="/" >首页</a></li><li class="nav-item"><a class="nav-link" href="/docs/" >手册</a></li><li class="nav-item"><a class="nav-link" href="/api/" >API文档</a></li><li class="nav-item"><a class="nav-link" href="/categories/blog/" >博客</a></li><li class="nav-item"><a class="nav-link" href="/categories/devel/" >开发日志</a></li><li class="nav-item"><a class="nav-link" href="/about/" >关于我们</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="hidden-md-up sm-header">
    <div class="toggler" id="slideClose"></div>
    <img src="../images/logo-green.png">
</div>
<div class="api-container clearfix">
    <nav>
        <div class="category hidden-md-up">
            <a href="/">首页</a>
            <a href="/docs/">手册</a>
            <a href="/api/">API文档</a>
            <a href="/categories/blog">博客</a>
            <a href="/categories/devel">开发日志</a>
            <a href="/about">关于我们</a>
        </div>
        <h3>Namespaces</h3><ul class = "entry-type-namespaces"><li><a href="TopJs.html" class="show-member-names">TopJs</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.Array.html" class="show-member-names">Array</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Assert.html" class="show-member-names">Assert</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Date.html" class="show-member-names">Date</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Error.html" class="show-member-names">Error</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Function.html" class="show-member-names">Function</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Loader.html" class="show-member-names">Loader</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Number.html" class="show-member-names">Number</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Object.html" class="show-member-names">Object</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.String.html" class="show-member-names">String</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Version.html" class="show-member-names">Version</a></li></ul></li><li><a href="TopJs.code.html" class="show-member-names">TopJs.code</a></li><li><a href="TopJs.code.generator.html" class="show-member-names">TopJs.code.generator</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.code.generator.AbstractGenerator.html" class="show-member-names">AbstractGenerator</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.code.generator.GeneratorInterface.html" class="show-member-names">GeneratorInterface</a></li></ul></li><li><a href="TopJs.eventmanager.html" class="show-member-names">TopJs.eventmanager</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.Callable.html" class="show-member-names">Callable</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.EventManagerAwareInterface.html" class="show-member-names">EventManagerAwareInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.EventManagerAwareTrait.html" class="show-member-names">EventManagerAwareTrait</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.EventsCapableInterface.html" class="show-member-names">EventsCapableInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.FilterInterface.html" class="show-member-names">FilterInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.ResponseCollection.html" class="show-member-names">ResponseCollection</a></li></ul></li><li><a href="TopJs.eventmanager.filter.html" class="show-member-names">TopJs.eventmanager.filter</a></li><li><a href="TopJs.kernel.html" class="show-member-names">TopJs.kernel</a></li><li><a href="TopJs.psr.html" class="show-member-names">TopJs.psr</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.psr.ContainerInterface.html" class="show-member-names">ContainerInterface</a></li></ul></li><li><a href="TopJs.servicemanager.html" class="show-member-names">TopJs.servicemanager</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.ConfigInterface.html" class="show-member-names">ConfigInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.ServiceLocatorInterface.html" class="show-member-names">ServiceLocatorInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.ServiceManager.html" class="show-member-names">ServiceManager</a></li></ul></li><li><a href="TopJs.servicemanager.factory.html" class="show-member-names">TopJs.servicemanager.factory</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.AbstractFactoryInterface.html" class="show-member-names">AbstractFactoryInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.DelegatorFactoryInterface.html" class="show-member-names">DelegatorFactoryInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.FactoryInterface.html" class="show-member-names">FactoryInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.InvokableFactory.html" class="show-member-names">InvokableFactory</a></li></ul></li><li><a href="TopJs.servicemanager.initializer.html" class="show-member-names">TopJs.servicemanager.initializer</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.initializer.InitializerInterface.html" class="show-member-names">InitializerInterface</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#compare">compare</a></li><li><a href="global.html#LINE_FEED">LINE_FEED</a></li><li><a href="global.html#MAX">MAX</a></li><li><a href="global.html#MIN">MIN</a></li></ul>
    </nav>
    <div id="main">
        
        <h1 class="page-title">stdlib/PriorityList.js</h1>
        

        



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
/*
 * TopJs Framework (http://www.topjs.org/)
 *
 * @link      http://github.com/qcoreteam/topjs for the canonical source repository
 * @copyright Copyright (c) 2016-2017 QCoreTeam (http://www.qcoreteam.org)
 * @license   http://www.topjs.org/license/new-bsd New BSD License
 */

TopJs.namespace("TopJs.stdlib");

/**
 * @class TopJs.stdlib.PriorityList
 */
class PriorityList {

    constructor()
    {
        /**
         * Internal list of all items.
         *
         * @property {Map} items
         */
        this.items = new Map();

        /**
         * Internal use for sort
         *
         * @property {Array} itemNames
         */
        this.itemNames = [];

        /**
         * Serial assigned to items to preserve LIFO.
         *
         * @property {Number} serial
         */
        this.serial = 0;

        /**
         * Serial order mode
         * @property {Number} isLifoFlag
         */
        this.isLifoFlag = 1;

        /**
         * Internal counter to avoid usage of count().
         *
         * @property {Number} count
         */
        this.count = 0;

        /**
         * Whether the list was already sorted.
         *
         * @property {Boolean} sorted
         */
        this.sorted = false;
    }
    /**
     * Insert a new item.
     *
     * @param {String} name
     * @param {Object} value
     * @param {Number} priority
     */
    insert(name, value, priority = 0)
    {
        if (!this.items.has(name)) {
            this.count++;
            this.itemNames.push(name);
        }
        priority = parseInt(priority);
        priority = isNaN(priority) ? 0 : priority;
        this.sorted = false;
        this.items.set(name, {
            data: value,
            priority: priority,
            serial: this.serial++
        });
    }

    /**
     * change target item priority
     *
     * @param {String} name the item name
     * @param {Number} priority the priority
     * @return {TopJs.stdlib.PriorityList}
     */
    setPriority(name, priority)
    {
        if (this.items.has(name)) {
            let target = this.items.get(name);
            target.priority = priority;
            this.sorted = false;
        }
        return this;
    }

    /**
     * delete item
     *
     * @param {String} name the name of target item to be delete
     * @return {TopJs.stdlib.PriorityList}
     */
    remove(name)
    {
        if (this.items.has(name)) {
            this.count--;
        }
        this.items.delete(name);
        return this;
    }

    /**
     * remove all items
     */
    clear()
    {
        this.items.clear();
        this.serial = 0;
        this.count = 0;
        this.sorted = false;
    }

    /**
     * Get a item by name
     *
     * @param {String} name
     * @return {Object|null}
     */
    get(name)
    {
        if (!this.items.has(name)) {
            return null;
        }
        let target = this.items.get(name);
        return target.data;
    }

    sort()
    {
        if (!this.sorted) {
            let items = this.items;
            let isLifoFlag = this.isLifoFlag;
            TopJs.Array.sort(this.itemNames, function (leftName, rightName)
            {
                let left = items.get(leftName);
                let right = items.get(rightName);
                return (left.priority === right.priority)
                    ? (left.serial > right.serial ? -1 : 1) * isLifoFlag
                    : (left.priority > right.priority ? -1 : 1);
            });
            this.sorted = true;
        }
    }

    /**
     * Get/Set serial order mode
     *
     * @param {Boolean|null} flag
     * @return {Boolean}
     */
    setIsLifoFlag(flag = null)
    {
        if (null !== flag) {
            let isLifo = flag === true ? 1 : -1;
            if (isLifo !== this.isLifoFlag) {
                this.isLifoFlag = isLifo;
                this.sorted = false;
            }
        }
        return 1 === this.isLifoFlag;
    }

    /**
     * get the items count
     *
     * @return {Number}
     */
    getCount()
    {
        return this.count;
    }

    /**
     * Return list as array
     *
     * @param {Number} flag
     * @return {Array}
     */
    toArray(flag = PriorityList.EXTRA_DATA)
    {
        this.sort();
        let items = [];
        if (flag == PriorityList.EXTRA_BOTH) {
            for (let [key, value] of this.items) {
                items.push([key, value]);
            }
            return items;
        }
        let itemMap = this.items;
        this.itemNames.forEach(function (name)
        {
            let item = itemMap.get(name);
            if (flag == PriorityList.EXTRA_PRIORITY) {
                items.push(item.priority);
            } else if (flag == PriorityList.EXTRA_DATA) {
                items.push(item.data);
            }
        });
        return items;
    }

    [Symbol.iterator]()
    {
        this.sort();
        let itemNames = this.itemNames;
        let items = this.items;
        return {
            current: 0,
            next ()
            {
                if (this.current &lt; itemNames.length) {
                    let key = itemNames[this.current++];
                    let item = items.get(key);
                    return {
                        value: [key, item.data],
                        done: false
                    };
                } else {
                    return {
                        value: undefined,
                        done: true
                    };
                }
            }
        };
    }
}

TopJs.apply(PriorityList, {
    EXTRA_DATA: 0x00000001,
    EXTRA_PRIORITY: 0x00000002,
    EXTRA_BOTH: 0x00000003
});

TopJs.registerClass("TopJs.stdlib.PriorityList", PriorityList);
module.exports = PriorityList;
</code></pre>
        </article>
    </section>




    </div>
</div>



<script src="../js/jquery.min.js"></script>
<script src="../js/tether.min.js" crossorigin="anonymous"></script>



<script src="../js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="../js/linenumber.js"></script>
<script src="../js/maodian.js"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-light.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
<script src="../js/extra.js"></script>
<script src="../js/common.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
