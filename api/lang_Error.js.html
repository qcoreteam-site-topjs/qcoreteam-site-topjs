<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>lang/Error.js - Documentation</title>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="../css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="../css/prettify.css">
    <link type="text/css" rel="stylesheet" href="../css/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="../css/extra.css">
    <link type="text/css" rel="stylesheet" href="../css/common.css">
</head>
<body>
<header class="navbar navbar-fixed-top fixed-header fixed-header-active header hidden-sm-down">
    <nav class="navbar navbar-light">

        <div class="">
            <button class="navbar-toggler hidden-lg-up float-xs-right" type="button" data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"></button>
            <a href="/"><img class="navbar-brand logo" src="../images/logo-green.png"></a>

            <div class="collapse navbar-toggleable-md float-lg-right" id="navbarResponsive">
                <ul class="nav navbar-nav float-lg-right">
                    <li class="nav-item"><a class="nav-link" href="/" >首页</a></li><li class="nav-item"><a class="nav-link" href="/docs/v0.0.1/" >手册</a></li><li class="nav-item"><a class="nav-link" href="/api/" >API文档</a></li><li class="nav-item"><a class="nav-link" href="/categories/blog/" >博客</a></li><li class="nav-item"><a class="nav-link" href="/categories/devel/" >开发日志</a></li><li class="nav-item"><a class="nav-link" href="/about/" >关于我们</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="hidden-md-up sm-header">
    <div class="toggler" id="slideClose"></div>
    <img src="../images/logo-green.png">
</div>
<div class="api-container clearfix">
    <nav>
        <div class="category hidden-md-up">
            <a href="/">首页</a>
            <a href="/docs/v0.0.1/">手册</a>
            <a href="/api/">API文档</a>
            <a href="/categories/blog">博客</a>
            <a href="/categories/devel">开发日志</a>
            <a href="/about">关于我们</a>
        </div>
        <h3>Namespaces</h3><ul class = "entry-type-namespaces"><li><a href="TopJs.html">TopJs</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.Array.html">Array</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Assert.html">Assert</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Base.html">Base</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Class.html">Class</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.ClassManager.html">ClassManager</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Config.html">Config</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Date.html">Date</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Error.html">Error</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Function.html">Function</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Loader.html">Loader</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Number.html">Number</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Object.html">Object</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.String.html">String</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Version.html">Version</a></li></ul></li><li><a href="TopJs.kernel.html">TopJs.kernel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#callParent">callParent</a></li><li><a href="global.html#callSuper">callSuper</a></li><li><a href="global.html#clearPropertiesOnDestroy">clearPropertiesOnDestroy</a></li><li><a href="global.html#destroyed">destroyed</a></li><li><a href="global.html#isConfiguring">isConfiguring</a></li><li><a href="global.html#isFirstInstance">isFirstInstance</a></li><li><a href="global.html#isInstance">isInstance</a></li><li><a href="global.html#statics">statics</a></li></ul>
    </nav>
    <div id="main">
        
        <h1 class="page-title">lang/Error.js</h1>
        

        



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * TopJs Framework (http://www.topjs.org/)
 *
 * @link      http://github.com/qcoreteam/topjs for the canonical source repository
 * @copyright Copyright (c) 2016-2017 QCoreTeam (http://www.qcoreteam.org)
 * @license   http://www.topjs.org/license/new-bsd New BSD License
 */
"use strict";

function to_string()
{
    let me = this;
    let cls = me.sourceClass;
    let method = me.sourceMethod;
    let msg = me.msg;
    if (method) {
        if (msg) {
            method += "(): ";
            method += msg;
        } else {
            method += "()";
        }
        if (cls) {
            method = method ? (cls + '.' + method) : cls;
        }
    }
    return method || msg || '';
}
/**
 * @classdesc
 * 定义一个原生的javascript`Error`对象的帮助类，添加一些在实现应用程序是经常使用的帮助方法
 * 当您在类系统中使用{@link TopJs.raise}方法抛出`TopJs.Error`异常的时候，错误类将自动的添加
 * 抛出异常时候的类名字和方法名字。我们包含一些逻辑，如果`TopJs.Error`携带额外的信息，可以自动的将`TopJs.Error`
 * 相关信息向`console`进行输出。在所有的情况下，在处理完相关逻辑后，系统将抛出`error`结束程序的运行。
 *
 * `TopJs.Error`同时提供一个全局的`error`, 您可以重写{@link TopJs.Error.handle}在应用程序范围中单点处理
 * 异常。在真实的程序中，一般会添加一些额外的逻辑，让错误记录更有实际意义。
 *
 * 简单使用
 * ```javascript
 * TopJs.raise("something bad happend!");
 * ```
 * 如果我们在普通的`javascript`代码中`raise error`, 错误将在控制台进行输出，将`error message`显示出来
 * 更多的情况我们是在`TopJs Class`中进行`raise`，系统将自动添加很多有用的信息，同时我们也可以手动添加一些错误的
 * 元信息。
 * 例如
 * ```javascript
 * TopJs.define("TopJs.SomeCls", {
     *      doSomething: function(option){
     *          if (someCondition === false) {
     *             TopJs.raise({
     *                msg: "错误的操作!",
     *                option: option, // 任意的常量对象
     *                "error code": 100
     *             });
     *          }
     *      }
     * });
 * ```
 * 控制台将输出如下信息：
 *
 *             option: Object { foo: "bar"}
 *                 oo: "bar"
 *         error code: 100
 *                msg: "错误的操作!"
 *        sourceClass: "TopJs.SomeCls"
 *       sourceMethod: "doSomething"
 *       uncaught exception: "错误的操作!"
 *
 * 正如您看到的`，TopJs.Error`会在控制台输出很多有用的信息
 *
 * 我们还可以处理全局所有的`error`，如下是一个例子：
 *
 * ```javascript
 * TopJs.Error.handle = function(err) {
     *     if (err.someProperty == "NotReallyAnError") {
     *         // maybe log something to the application here if applicable
     *         return true;
     *     }
     * }
 * ```
 *
 * @class TopJs.Error
 * @constructor
 */
let TopJsError = TopJs.Error = function (config)
{
    if (TopJs.isString(config)) {
        config = {
            msg: config
        };
    }
    let error = new Error();
    TopJs.apply(error, config);
    error.message = error.message || error.msg; // "message" is standard ("msg" is non-standard)
    error.toString = to_string;
    return error;
};

TopJs.apply(TopJsError, /** @lends TopJs.Error */{
    /**
     * 全局标志变量，当设置为`true`禁止全局错误报告。使用的时候要特别小心，当我们禁止`TopJs.Error`处理
     * 可能我们的程序会被原生的异常终止，更好的选择是重写{@link TopJs.Erorr.handle}方法进行全局的错误
     * 处理。
     *
     * 简单的例子：
     * ```javascript
     * TopJs.Error.ignore = true;
     * ```
     *
     * @property {Boolean} [ignore=false]
     */
    ignore: false,
    /**
     * @private
     * @param {String/Object} error 错误字符串，或者包含自定义信息的错误对象，自定义对象必须含有一个`msg`字段
     * 自定义信息将在控制台输出
     * @param {Function} processer 额外的处理器，对传入的对象对相关的处理
     */
    raise(error, processer = TopJs.emptyFn)
    {
        let msg;
        error = error || {};
        if (TopJs.isString(error)) {
            error = {
                msg: error
            }
        }
        processer(error);
        if (this.handle(error) !== true) {
            msg = to_string.call(error);
            //&lt;debug>
            TopJs.log({
                msg: msg,
                level: "error",
                dump: error,
                stack: true
            });
            //&lt;/debug>
            throw new TopJs.Error(error);
        }
    },

    /**
     * 全局处理`TopJs errors`模板函数，您可以重写这个函数，加上一些自定义的错误处理逻辑
     * 这跟函数返回`true`,将不会抛出异常。
     *
     * @param {Object} error 错误字符串，或者包含自定义信息的错误对象，自定义对象必须含有一个`msg`字段
     * 自定义信息将在控制台输出
     * @return {boolean}
     */
    handle()
    {
        return this.ignore;
    }
});

/**
 * 创建一个函数，调用的时候抛出一个异常,并且输出一个弃用的信息
 *
 * @private
 * @param {String} suggestion 需要输出的信息
 * @return {Function} 生成的函数
 */
TopJs.deprecated = function (suggestion)
{
    //&lt;debug>
    if (!suggestion) {
        suggestion = '';
    }
    function fail()
    {
        TopJs.raise("方法 \"" + fail.$_owner_$.$_class_name_$ +
            '.' + fail.$_name_$ + "\"已经被弃用了。" + suggestion);
    }

    return fail;
    //&lt;/debug>
    return TopJs.emptyFn;
};

/**
 * 抛出一个错误，同时将错误信息在控制台进行输出，如果`error`对象包含额外信息也会被一并进行输出
 * 您可以传入一个字符串或者一个带有`msg`属性的常量对象，如果传入的是常理对象，您可以添加的额外的
 * 键值对，用于输出更有用的错误信息。
 *
 * 当系统完成错误信息之后，将抛出一个`javascript error`来终止程序的执行。
 *
 * 简单用法:
 * ```javascript
 * //简单的例子
 * TopJs.raise("A simple string error message");
 * // 复杂一点的例子
 * TopJs.define("TopJs.SomeCls", {
     *      doSomething: function(option){
     *          if (someCondition === false) {
     *             TopJs.raise({
     *                msg: "错误的操作!",
     *                option: option, // 任意的常量对象
     *                "error code": 100
     *             });
     *          }
     *      }
     * });
 *
 * ```
 *
 * @param {String/Object} error 错误字符串，或者包含自定义信息的错误对象，自定义对象必须含有一个`msg`字段
 * 自定义信息将在控制台输出
 */
TopJs.raise = function (error)
{
    let method = TopJs.raise;
    TopJs.Error.raise.call(TopJs.Error, error, function (error)
    {
        let name;
        if (!error.sourceMethod &amp;&amp; (name = method.$_name_$)) {
            error.sourceMethod = name;
        }
        if (!error.sourceClass &amp;&amp; (name = method.$_owner_$) &amp;&amp; (name = name.$_class_name_$)) {
            error.sourceClass = name;
        }
    });
};
</code></pre>
        </article>
    </section>




    </div>
</div>



<script src="../js/jquery.min.js"></script>
<script src="../js/tether.min.js" crossorigin="anonymous"></script>

<script src="../js/prettify/prettify.js"></script>
<script src="../js/prettify/lang-css.js"></script>
<script>prettyPrint();</script>

<script src="../js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="../js/linenumber.js"></script>
<script src="../js/maodian.js"></script>

<script src="../js/extra.js"></script>
<script src="../js/common.js"></script>
</body>
</html>
