<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>kernel/lang/String.js - Documentation</title>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="../css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="../css/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="../css/extra.css">
    <link type="text/css" rel="stylesheet" href="../css/common.css">
    <link type="text/css" rel="stylesheet" href="../css/highlight.css">
</head>
<body>
<header class="navbar navbar-fixed-top fixed-header fixed-header-active header hidden-sm-down">
     <nav class="navbar-light">

        <div class="">
            <button class="navbar-toggler hidden-lg-up float-xs-right" type="button" data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"></button>
            <a href="/"><img class="navbar-brand logo" src="../images/logo-green.png"></a>

            <div class="collapse navbar-toggleable-md float-lg-right" id="navbarResponsive">
                <ul class="nav navbar-nav float-lg-right">
                    <li class="nav-item"><a class="nav-link" href="/" >首页</a></li><li class="nav-item"><a class="nav-link" href="/docs/" >手册</a></li><li class="nav-item"><a class="nav-link" href="/api/" >API文档</a></li><li class="nav-item"><a class="nav-link" href="/categories/blog/" >博客</a></li><li class="nav-item"><a class="nav-link" href="/categories/devel/" >开发日志</a></li><li class="nav-item"><a class="nav-link" href="/about/" >关于我们</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="hidden-md-up sm-header">
    <div class="toggler" id="slideClose"></div>
    <img src="../images/logo-green.png">
</div>
<div class="api-container clearfix">
    <nav>
        <div class="category hidden-md-up">
            <a href="/">首页</a>
            <a href="/docs/v0.0.1/">手册</a>
            <a href="/api/">API文档</a>
            <a href="/categories/blog">博客</a>
            <a href="/categories/devel">开发日志</a>
            <a href="/about">关于我们</a>
        </div>
        <h3>Namespaces</h3><ul class = "entry-type-namespaces"><li><a href="TopJs.html" class="show-member-names">TopJs</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.Array.html" class="show-member-names">Array</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Assert.html" class="show-member-names">Assert</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Date.html" class="show-member-names">Date</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Error.html" class="show-member-names">Error</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Function.html" class="show-member-names">Function</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Loader.html" class="show-member-names">Loader</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Number.html" class="show-member-names">Number</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Object.html" class="show-member-names">Object</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.String.html" class="show-member-names">String</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Version.html" class="show-member-names">Version</a></li></ul></li><li><a href="TopJs.code.html" class="show-member-names">TopJs.code</a></li><li><a href="TopJs.code.generator.html" class="show-member-names">TopJs.code.generator</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.code.generator.AbstractGenerator.html" class="show-member-names">AbstractGenerator</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.code.generator.GeneratorInterface.html" class="show-member-names">GeneratorInterface</a></li></ul></li><li><a href="TopJs.eventmanager.html" class="show-member-names">TopJs.eventmanager</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.Callable.html" class="show-member-names">Callable</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.EventManagerAwareInterface.html" class="show-member-names">EventManagerAwareInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.EventManagerAwareTrait.html" class="show-member-names">EventManagerAwareTrait</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.EventsCapableInterface.html" class="show-member-names">EventsCapableInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.FilterInterface.html" class="show-member-names">FilterInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.ResponseCollection.html" class="show-member-names">ResponseCollection</a></li></ul></li><li><a href="TopJs.eventmanager.filter.html" class="show-member-names">TopJs.eventmanager.filter</a></li><li><a href="TopJs.kernel.html" class="show-member-names">TopJs.kernel</a></li><li><a href="TopJs.psr.html" class="show-member-names">TopJs.psr</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.psr.ContainerInterface.html" class="show-member-names">ContainerInterface</a></li></ul></li><li><a href="TopJs.servicemanager.html" class="show-member-names">TopJs.servicemanager</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.ConfigInterface.html" class="show-member-names">ConfigInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.ServiceLocatorInterface.html" class="show-member-names">ServiceLocatorInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.ServiceManager.html" class="show-member-names">ServiceManager</a></li></ul></li><li><a href="TopJs.servicemanager.factory.html" class="show-member-names">TopJs.servicemanager.factory</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.AbstractFactoryInterface.html" class="show-member-names">AbstractFactoryInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.DelegatorFactoryInterface.html" class="show-member-names">DelegatorFactoryInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.FactoryInterface.html" class="show-member-names">FactoryInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.InvokableFactory.html" class="show-member-names">InvokableFactory</a></li></ul></li><li><a href="TopJs.servicemanager.initializer.html" class="show-member-names">TopJs.servicemanager.initializer</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.initializer.InitializerInterface.html" class="show-member-names">InitializerInterface</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#compare">compare</a></li><li><a href="global.html#LINE_FEED">LINE_FEED</a></li><li><a href="global.html#MAX">MAX</a></li><li><a href="global.html#MIN">MIN</a></li></ul>
    </nav>
    <div id="main">
        
        <h1 class="page-title">kernel/lang/String.js</h1>
        

        



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
/*
 * TopJs Framework (http://www.topjs.org/)
 *
 * @link      http://github.com/qcoreteam/topjs for the canonical source repository
 * @copyright Copyright (c) 2016-2017 QCoreTeam (http://www.qcoreteam.org)
 * @license   http://www.topjs.org/license/new-bsd New BSD License
 */
import {trim, ltrim, rtrim, is_string, change_str_at} from '../internal/Funcs';

let StringObject = TopJs.String = {};
let charToEntity = new Map();
let entityToChar = new Map();
let charToEntityRegex;
let entityToCharRegex;
let escapeRegexRe = /([-.*+?\^${}()|\[\]\/\\])/g;
let escapeRe = /('|\\)/g;
function bounds_check(str, other)
{
    if (null === str || undefined === str || null === other || undefined === other) {
        return false;
    }
    return other.length &lt;= str.length;
}

function html_encode_replace(match, capture)
{
    return charToEntity.get(capture);
}

function html_decode_replace(match, capture)
{
    return (entityToChar.has(capture)) ? entityToChar.get(capture) :
        String.fromCharCode(parseInt(capture.substr(2), 10));
}

//@requires TopJs.Array
/**
 * @class TopJs.String
 * @singleton
 */
TopJs.apply(StringObject, /** @lends TopJs.String */{
    /**
     * 向目标字符串插入子串到指定的位置
     *
     * ```javascript
     * TopJs.String.insert("abcdefg", "h", -1);
     * // abcdefhg
     *
     * ```
     * @param {String} str 原始的字符串
     * @param {String} value 需要插入的子字符串
     * @param {Number} index 需要插入的位置
     * @return {String} 插入子串的结果字符串
     */
    insert(str, value, index)
    {
        if (!str) {
            return value;
        }
        if (!value) {
            return str;
        }
        let len = str.length;
        if (!index &amp;&amp; index !== 0) {
            index = len;
        }
        if (index &lt; 0) {
            index *= -1;
            if (index >= len) {
                index = 0;
            } else {
                index = len - index;
            }
        }
        if (0 === index) {
            str = value + str;
        } else if (index >= str.length) {
            str += value;
        } else {
            str = str.substr(0, index) + value + str.substr(index);
        }
        return str;
    },

    /**
     * 检查一个字符是否以指定的子串开始
     *
     * @param {String} str 原始字符串
     * @param {Number} start 子串检查的起始位移
     * @param {Number} position 在`str`中搜索`start`的开始位置，默认值为 0，也就是真正的字符串开头处
     * @param {Boolean} [ignoreCase=false] 是否忽略大小写
     * @return {Boolean} 检查的结果
     */
    startsWith(str, start, position = 0, ignoreCase = false)
    {
        let result = bounds_check(str, start);
        if (result) {
            if (ignoreCase) {
                str = str.toLowerCase();
                start = start.toLowerCase();
            }
            result = str.startsWith(start, position);
        }
        return result;
    },

    /**
     * 检查一个字符是否以指定的子串结束
     *
     * @param {String} str 原始字符串
     * @param {Number} end 子串检查的结束位移
     * @param {Number} [position=str.length] 在`str`中搜索`end`的结束位置，默认值为`str.length`，也就是真正的字符串结尾处
     * @param {Boolean} [ignoreCase=false] 是否忽略大小写
     * @return {Boolean} 检查的结果
     */
    endsWith(str, end, position, ignoreCase = false)
    {
        let result = bounds_check(str, end);
        if (result) {
            if (ignoreCase) {
                str = str.toLowerCase();
                end = end.toLowerCase();
            }
            position = position ? position : str.length;
            result = str.endsWith(end, position);
        }
        return result;
    },

    /**
     * 将当前的字符串 `(&amp;, &lt;, >, ', and ")` 转换成html实体代码，便于在前端展示
     *
     * @param {String} value 等待转义的字符串
     * @return {String}
     */
    htmlEncode(value)
    {
        return (!value) ? value : String(value).replace(charToEntityRegex, html_encode_replace);
    },

    /**
     * 将html实体代码转换成，`(&amp;, &lt;, >, ', and ")`字符
     *
     * @param {String} value 等待转义的字符串
     * @return {String}
     */
    htmlDecode(value)
    {
        return (!value) ? value : String(value).replace(entityToCharRegex, html_decode_replace);
    },

    /**
     * 判断字符串是否包含需要转义的html字符
     *
     * @param {String} str 判断字符串是否含有html实体
     * @return {Boolean}
     */
    hasHtmlChars(str)
    {
        return charToEntityRegex.test(str);
    },

    /**
     * 增加html实体集定义，用于支持函数{@link TopJs.String.htmlEncode}和函数{@link TopJs.String.htmlDecode}
     *
     * ```javascript
     * TopJs.String.addCharEntities({
       *    '&amp;amp;Uuml;':'Ü',
       *    '&amp;amp;ccedil;':'ç',
       *    '&amp;amp;ntilde;':'ñ',
       *    '&amp;amp;egrave;':'è'
       * });
     * let s = TopJs.String.htmlEncode("A string with entities: èÜçñ");
     * ```
     * 您可以使用函数对实体集合进行重置{@link TopJs.String.resetCharEntities}
     *
     * @param {Object} entities
     * @param {String} entities.key html实体定义
     * @param {String} entities.value html实体对应的字符表示
     * @return {Null}
     */
    addCharEntities(entities)
    {
        let charKeys = [];
        let entityKeys = [];
        for (let [key, echar] of Object.entries(entities)) {
            entityToChar.set(key, echar);
            charToEntity.set(echar, key);
            charKeys.push(echar);
            entityKeys.push(key);
        }
        charToEntityRegex = new RegExp('(' + charKeys.join('|') + ')', 'g');
        entityToCharRegex = new RegExp('(' + entityKeys.join('|') + '|&amp;#[0-9]{1,5};' + ')', 'g');
    },

    /**
     * 重置字符实体定义到默认状态，这个定义在函数{@link TopJs.String.htmlEncode}和函数{@link TopJs.String.htmlDecode}
     * 中使用
     *
     * @return {Null}
     */
    resetCharEntities()
    {
        charToEntity.clear();
        entityToChar.clear();
        //添加默认的集合
        this.addCharEntities({
            "&amp;amp;": '&amp;',
            "&amp;gt;": '>',
            "&amp;lt;": '&lt;',
            "&amp;quot;": '"',
            "&amp;#39;": "'"
        });
    },

    /**
     * 给一个`url`字符串添加查询子串，自动判断
     *
     * @param {String} url 目标字符串
     * @param {String} string 将要添加到`url`的字符串
     * @return {String} 结果字符串
     */
    urlAppend(url, string)
    {
        if (!TopJs.isEmpty(string)) {
            return url + (url.indexOf('?') === -1 ? '?' : '&amp;') + string;
        }
        return url;
    },

    /**
     * 删除字符串首尾的空格，中间的空格不处理
     *
     * ```javascript
     * let s = "  hello TopJs  ";
     * console.log(TopJs.String.trim(s));  //console.log("hello TopJs")
     * ```
     *
     * @method
     * @param {String} str 等待处理字符串
     * @param {String} [charList] 需要过滤的字符集
     */
    trim: trim,

    /**
     * 删除字符串左边的空格，其余地方的空格不处理
     *
     * ```javascript
     * let s = "  hello word  ";
     * console.log(TopJs.String.trim(s));  //console.log("hello word  ")
     * ```
     * @method
     * @param {String} str 等待处理字符串
     * @param {String} [charList] 需要过滤的字符集
     * @return {String} 处理后的字符串
     */
    ltrim: ltrim,

    /**
     * 删除字符串右边的空格，其余地方的空格不处理
     *
     * ```javascript
     * let s = "  foo bar  ";
     * console.log(TopJs.String.trim(s));  //console.log("  foo bar")
     * ```
     * @method
     * @param {String} str 等待处理字符串
     * @param {String} [charList] 需要过滤的字符集
     * @return {String} 处理后的字符串
     */
    rtrim: rtrim,

    /**
     * 将给定的字符串的首字母大写
     *
     * @param {String} string 等待处理的字符串
     * @return {String} 处理之后的字符串
     */
    capitalize(string)
    {
        if (string) {
            string = string.charAt(0).toUpperCase() + string.substr(1);
        }
        return string || '';
    },

    /**
     * 将给定的字符串的首字母小写
     *
     * @param {String} string 等待处理的字符串
     * @return {String} 处理之后的字符串
     */
    uncapitalize(string)
    {
        if (string) {
            string = string.charAt(0).toLowerCase() + string.substr(1);
        }
        return string || '';
    },

    /**
     * 当给定的字符串`value`长度超过指定`length`的时候显示`...`
     *
     * @param {String} value 需要处理的字符串
     * @param {Number} length 显示省略号的最小长度
     * @param {Boolean} [word=false] `true`智能分割单词
     * @return {String} 转换后的字符串
     */
    ellipsis(value, length, word = false)
    {
        if (value &amp;&amp; value.length > length) {
            if (word) {
                let vs = value.substr(0, length - 2);
                let index = Math.max(vs.lastIndexOf(' '), vs.lastIndexOf('.'), vs.lastIndexOf('!'), vs.lastIndexOf('?'));
                if (index !== -1 &amp;&amp; index >= (length - 15)) {
                    return vs.substr(0, index) + "...";
                }
            }
            return value.substr(0, length - 3) + "...";
        }
        return value;
    },

    /**
     * 对传入的字符进行转义，处理里面的正则的特殊符号
     *
     * @param {String} string 等待处理的字符串
     * @return {String} 过滤之后的字符串
     */
    escapeRegex(string)
    {
        return string.replace(escapeRegexRe, "\\$1");
    },

    /**
     * 通过制定的字符串，创建正则表达式对象
     *
     * @param {String/RegExp} value 转换成正则的字符串
     * @param {Boolean} startsWith 正则表达式开始的部分
     * @param {Boolean} endsWith 正则表达式结束的部分
     * @param {Boolean} ignoreCase 是否忽略大小写
     * @return {RegExp} 创建的正则表达式
     */
    createRegex(value, startsWith, endsWith, ignoreCase)
    {
        let ret = value;
        if (value !== null &amp;&amp; !value.exec) {
            StringObject.escapeRegex(value);
            if (startsWith !== false) {
                ret = '^' + ret;
            }
            if (endsWith !== false) {
                ret += '$';
            }
            ret = new RegExp(ret, (false !== ignoreCase) ? 'i' : '');
        }
        return ret;
    },

    /**
     * 转义字符串里面的`'`和`\`
     *
     * @param {String} string 等待转换的字符串
     * @return {String} 转换完成的字符串
     */
    escape(string)
    {
        return string.replace(escapeRe, "\\$1");
    },

    /**
     * 工具函数，根据`string`当前的值，让函数的返回值在`value1`和`value2`之间来回切换
     *
     * @param {String} string 用来比对的字符串
     * @param {String} value1 可能的值之一
     * @param {String} value2 可能的值之一
     * @return {String} 返回翻转之后的值
     */
    toggle(string, value1, value2)
    {
        return (string === value1) ? value2 : value1;
    },

    /**
     * 根据指定的宽度`size`在字符串`string`左边补充`char`指定的字符
     *
     * @param {String} string
     * @param {Number} size
     * @param {String} [char=' ']
     */
    leftPad(string, size, char = ' ')
    {
        let ret = String(string);
        while (ret.length &lt; size) {
            ret = char + ret;
        }
        return ret;
    },

    /**
     * 将模式字符串重复指定的次数，使用`sep`指定的参数进行分隔
     *
     * @param {String} pattern 用来重复的模式字符串
     * @param {Number} count 重复的次数
     * @param {String} [sep=''] 分隔字符
     * @return {String}
     */
    repeat(pattern, count, sep = '')
    {
        if (count &lt; 1) {
            count = 0;
        }
        let ret = [];
        for (let i = 0; i &lt; count; i++) {
            ret.push(pattern);
        }
        return ret.join(sep);
    }
});
StringObject.resetCharEntities();</code></pre>
        </article>
    </section>




    </div>
</div>



<script src="../js/jquery.min.js"></script>
<script src="../js/tether.min.js" crossorigin="anonymous"></script>



<script src="../js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="../js/linenumber.js"></script>
<script src="../js/maodian.js"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-light.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
<script src="../js/extra.js"></script>
<script src="../js/common.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
