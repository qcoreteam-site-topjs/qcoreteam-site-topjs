<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>kernel/utils/Version.js - Documentation</title>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="../css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="../css/prettify.css">
    <link type="text/css" rel="stylesheet" href="../css/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="../css/extra.css">
    <link type="text/css" rel="stylesheet" href="../css/common.css">
</head>
<body>
<header class="navbar navbar-fixed-top fixed-header fixed-header-active header hidden-sm-down">
    <nav class="navbar navbar-light">

        <div class="">
            <button class="navbar-toggler hidden-lg-up float-xs-right" type="button" data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"></button>
            <a href="/"><img class="navbar-brand logo" src="../images/logo-green.png"></a>

            <div class="collapse navbar-toggleable-md float-lg-right" id="navbarResponsive">
                <ul class="nav navbar-nav float-lg-right">
                    <li class="nav-item"><a class="nav-link" href="/" >首页</a></li><li class="nav-item"><a class="nav-link" href="/docs/v0.0.1/" >手册</a></li><li class="nav-item"><a class="nav-link" href="/api/" >API文档</a></li><li class="nav-item"><a class="nav-link" href="/categories/blog/" >博客</a></li><li class="nav-item"><a class="nav-link" href="/categories/devel/" >开发日志</a></li><li class="nav-item"><a class="nav-link" href="/about/" >关于我们</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="hidden-md-up sm-header">
    <div class="toggler" id="slideClose"></div>
    <img src="../images/logo-green.png">
</div>
<div class="api-container clearfix">
    <nav>
        <div class="category hidden-md-up">
            <a href="/">首页</a>
            <a href="/docs/v0.0.1/">手册</a>
            <a href="/api/">API文档</a>
            <a href="/categories/blog">博客</a>
            <a href="/categories/devel">开发日志</a>
            <a href="/about">关于我们</a>
        </div>
        <h3>Namespaces</h3><ul class = "entry-type-namespaces"><li><a href="TopJs.html" class="show-member-names">TopJs</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.Array.html" class="show-member-names">Array</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Assert.html" class="show-member-names">Assert</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Date.html" class="show-member-names">Date</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Error.html" class="show-member-names">Error</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Function.html" class="show-member-names">Function</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Loader.html" class="show-member-names">Loader</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Number.html" class="show-member-names">Number</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Object.html" class="show-member-names">Object</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.String.html" class="show-member-names">String</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Version.html" class="show-member-names">Version</a></li></ul></li><li><a href="TopJs.code.html" class="show-member-names">TopJs.code</a></li><li><a href="TopJs.code.generator.html" class="show-member-names">TopJs.code.generator</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.code.generator.AbstractGenerator.html" class="show-member-names">AbstractGenerator</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.code.generator.GeneratorInterface.html" class="show-member-names">GeneratorInterface</a></li></ul></li><li><a href="TopJs.eventmanager.html" class="show-member-names">TopJs.eventmanager</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.Callable.html" class="show-member-names">Callable</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.EventManagerAwareInterface.html" class="show-member-names">EventManagerAwareInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.EventManagerAwareTrait.html" class="show-member-names">EventManagerAwareTrait</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.EventsCapableInterface.html" class="show-member-names">EventsCapableInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.FilterInterface.html" class="show-member-names">FilterInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.eventmanager.ResponseCollection.html" class="show-member-names">ResponseCollection</a></li></ul></li><li><a href="TopJs.eventmanager.filter.html" class="show-member-names">TopJs.eventmanager.filter</a></li><li><a href="TopJs.kernel.html" class="show-member-names">TopJs.kernel</a></li><li><a href="TopJs.psr.html" class="show-member-names">TopJs.psr</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.psr.ContainerInterface.html" class="show-member-names">ContainerInterface</a></li></ul></li><li><a href="TopJs.servicemanager.html" class="show-member-names">TopJs.servicemanager</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.ConfigInterface.html" class="show-member-names">ConfigInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.ServiceLocatorInterface.html" class="show-member-names">ServiceLocatorInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.ServiceManager.html" class="show-member-names">ServiceManager</a></li></ul></li><li><a href="TopJs.servicemanager.factory.html" class="show-member-names">TopJs.servicemanager.factory</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.AbstractFactoryInterface.html" class="show-member-names">AbstractFactoryInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.DelegatorFactoryInterface.html" class="show-member-names">DelegatorFactoryInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.FactoryInterface.html" class="show-member-names">FactoryInterface</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.factory.InvokableFactory.html" class="show-member-names">InvokableFactory</a></li></ul></li><li><a href="TopJs.servicemanager.initializer.html" class="show-member-names">TopJs.servicemanager.initializer</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.servicemanager.initializer.InitializerInterface.html" class="show-member-names">InitializerInterface</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#compare">compare</a></li><li><a href="global.html#LINE_FEED">LINE_FEED</a></li><li><a href="global.html#MAX">MAX</a></li><li><a href="global.html#MIN">MIN</a></li></ul>
    </nav>
    <div id="main">
        
        <h1 class="page-title">kernel/utils/Version.js</h1>
        

        



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
/*
 * TopJs Framework (http://www.topjs.org/)
 *
 * @link      http://github.com/qcoreteam/topjs for the canonical source repository
 * @copyright Copyright (c) 2016-2017 QCoreTeam (http://www.qcoreteam.org)
 * @license   http://www.topjs.org/license/new-bsd New BSD License
 */
let endOfVersionRe = /([^\d\.])/;
let notDigitsRe = /[^\d]/g;
let plusMinusRe = /[\-+]/g;
let underscoreRe = /_/g;
/**
 * @class TopJs.Version
 * @classdesc
 *
 * 一个工具类重新封装一个版本字符串数据，然后提供一些很方便的函数用于比较不同的版本号
 * 一个版本字符串可以像下面这样的格式：
 *
 * `major[.minor[.patch[.build[release]]]]`
 */
let Version = TopJs.Version = function (version, defaultMode)
{
    let padModes = this.padModes;
    let ch, pad,
        parts, release,
        releaseStartIndex, ver;
    if (version.isVersion) {
        version = version.version;
    }
    this.version = ver = String(version).toLowerCase()
    .replace(underscoreRe, '').replace(plusMinusRe, '');
    ch = ver.charAt(0);
    if (ch in padModes) {
        ver = ver.substring(1);
        pad = padModes[ch];
    } else {
        pad = defaultMode ? padModes[defaultMode] : 0; // careful - NaN is falsey!
    }
    this.pad = pad;
    releaseStartIndex = ver.search(endOfVersionRe);
    this.shortVersion = ver;
    if (releaseStartIndex !== -1) {
        this.release = release = ver.substr(releaseStartIndex, version.length);
        this.shortVersion = ver.substr(0, releaseStartIndex);
        release = Version.releaseValueMap[release] || release;
    }

    this.releaseValue = release || pad;
    this.shortVersion = this.shortVersion.replace(notDigitsRe, '');
    /**
     * @property {Array} parts 版本字符串的数组切分部分
     * 例如 "1.2.3" 转换成 [1, 2, 3]
     * @readonly
     * @private
     */
    this.parts = parts = ver.split('.');
    for (let i = parts.length; i--;) {
        parts[i] = parseInt(parts[i], 10);
    }
    if (pad === Infinity) {
        // have to add this to the end to create an upper bound:
        parts.push(pad);
    }
    /**
     * @property {Number} major 版本字符串第一部分
     * @readonly
     */
    this.major = parts[0] || pad;
    /**
     * @property {Number} minor 版本字符串第二部分
     * @readonly
     */
    this.minor = parts[1] || pad;
    /**
     * @property {Number} minor 版本字符串第三部分
     * @readonly
     */
    this.patch = parts[2] || pad;
    /**
     * @property {Number} minor 版本字符串第四部分
     * @readonly
     */
    this.build = parts[3] || pad;
};

TopJs.apply(Version.prototype, /** @lends TopJs.Version.prototype */ {
    /**
     * @private
     */
    isVersion: true,
    /**
     * @private
     * @property {Object} padModes 边界类型，两种类型一种是`NaN`一种是`Infinity`
     */
    padModes: {
        '~': NaN,
        '^': Infinity
    },

    /**
     * 支持如下类型：
     *
     *  * `dev`
     *  * `alpha` 或者 `a`
     *  * `beta` 或者 `b`
     *  * `RC` 或者 `rc`
     *  * `#`
     *  * `pl` 或者 `p`
     *
     * @property {String} [release=""]  发布级别字符串
     *
     */
    release: '',

    /**
     * 将当前的版本对象跟传入的`other`进行版本比较
     * @param {String|Number|TopJs.Version} other 用来比较的版本信息
     * @return {Number} `-1` 代表小于传入对象，`0`代表与传入对象相等，`1`代表大于传入对象
     */
    compareTo(other)
    {
        let lhsPad = this.pad;
        let lhsParts = this.parts;
        let lhsLength = lhsParts.length;
        let rhsVersion = other.isVersion ? other : new Version(other);
        let rhsPad = rhsVersion.pad;
        let rhsParts = rhsVersion.parts;
        let rhsLength = rhsParts.length;
        let length = Math.max(lhsLength, rhsLength);
        let lhs;
        let rhs;
        for (let i = 0; i &lt; length; i++) {
            lhs = (i &lt; lhsLength) ? lhsParts[i] : lhsPad;
            rhs = (i &lt; rhsLength) ? rhsParts[i] : rhsPad;
            if (lhs &lt; rhs) {
                return -1;
            }
            if (lhs > rhs) {
                return 1;
            }
        }

        lhs = this.releaseValue;
        rhs = rhsVersion.releaseValue;
        if (lhs &lt; rhs) {
            return -1;
        }
        if (lhs > rhs) {
            return 1;
        }
        return 0;
    },

    /**
     * @private
     * @return {String} 版本字符串
     */
    toString()
    {
        return this.version;
    },

    /**
     * @private
     * @return {String} 版本字符串
     */
    valueOf()
    {
        return this.version;
    },

    /**
     * 获取版本字符串的`major`部分
     *
     * @return {Number}
     */
    getMajor()
    {
        return this.major;
    },

    /**
     * 获取版本字符串的`minor`部分
     *
     * @return {Number}
     */
    getMinor()
    {
        return this.minor;
    },

    /**
     * 获取版本字符串的`patch`部分
     *
     * @return {Number}
     */
    getPatch()
    {
        return this.patch;
    },

    /**
     * 获取版本字符串的`build`部分
     *
     * @return {Number}
     */
    getBuild()
    {
        return this.build;
    },

    /**
     * 获取版本字符串的`release`文本，(例如: `beta`)
     *
     * @return {String}
     */
    getRelease: function ()
    {
        return this.release;
    },

    /**
     * 获取版本的`release`值，这个值用于版本比较大小
     *
     * @return {Number|String}
     */
    getReleaseValue()
    {
        return this.releaseValue;
    },

    /**
     * 判断当前的版本是否大于`target`指定的版本
     *
     * @param {String|Number|TopJs.Version} target 目标比较的版本
     * @return {Boolean} `true`如果大于指定的版本对象
     */
    isGreaterThan(target)
    {
        return this.compareTo(target) > 0;
    },

    /**
     * 判断当前的版本是否大于或者等于`target`指定的版本
     *
     * @param {String|Number|TopJs.Version} target 目标比较的版本
     * @return {Boolean} `true`如果大于或者等于指定的版本对象
     */
    isGreaterThanOrEqual(target)
    {
        return this.compareTo(target) >= 0;
    },

    /**
     * 判断当前的版本是否小于`target`指定的版本
     *
     * @param {String|Number|TopJs.Version} target 目标比较的版本
     * @return {Boolean} `true`如果小于指定的版本对象
     */
    isLessThan(target)
    {
        return this.compareTo(target) &lt; 0;
    },

    /**
     * 判断当前的版本是否小于或者等于`target`指定的版本
     *
     * @param {String|Number|TopJs.Version} target 目标比较的版本
     * @return {Boolean} `true`如果小于或者等于指定的版本对象
     */
    isLessThanOrEqual(target)
    {
        return this.compareTo(target) &lt;= 0;
    },

    /**
     * 判断当前的版本是否等于`target`指定的版本
     *
     * @param {String|Number|TopJs.Version} target 目标比较的版本
     * @return {Boolean} `true`如果者等于指定的版本对象
     */
    equals(target)
    {
        return this.compareTo(target) === 0;
    },

    /**
     * 判断提供的版本数据是否跟当前的版本匹配
     *
     * ```javascript
     * let version = new TopJs.Version('1.0.2beta');
     * console.log(version.match(1)); // true
     * console.log(version.match(1.0)); // true
     * console.log(version.match('1.0.2')); // true
     * console.log(version.match('1.0.2RC')); // false
     *
     * ```
     *
     * @param {String|Number} target 用来比较的版本数据
     * @return {Boolean} `true`代表`target`版本字符串匹配当前的版本
     */
    match(target)
    {
        target = String(target);
        return this.version.substr(0, target.length) === target;
    },

    /**
     * 返回版本数据的数组表示，便于比较版本的大小
     *
     * @return {Number[]}
     */
    toArray()
    {
        return [
            this.getMajor(), this.getMinor(),
            this.getPatch(), this.getBuild(),
            this.getRelease()
        ];
    },

    /**
     * 获取版本的简洁描述，去掉点和release信息
     *
     * @return {String}
     */
    getShortVersion()
    {
        return this.shortVersion;
    },

    /**
     * 判断当前的版本是否大于`target`指定的版本
     *
     * @param {String|Number|TopJs.Version} target 目标比较的版本
     * @return {Boolean} `true`如果大于指定的版本对象
     */
    gt(target)
    {
        return this.compareTo(target) > 0;
    },

    /**
     * 判断当前的版本是否小于`target`指定的版本
     *
     * @param {String|Number|TopJs.Version} target 目标比较的版本
     * @return {Boolean} `true`如果小于指定的版本对象
     */
    lt(target)
    {
        return this.compareTo(target) &lt; 0;
    },

    /**
     * 判断当前的版本是否大于或者等于`target`指定的版本
     *
     * @param {String|Number|TopJs.Version} target 目标比较的版本
     * @return {Boolean} `true`如果大于或者等于指定的版本对象
     */
    gte(target)
    {
        return this.compareTo(target) >= 0;
    },

    /**
     * 判断当前的版本是否小于或者等于`target`指定的版本
     *
     * @param {String|Number|TopJs.Version} target 目标比较的版本
     * @return {Boolean} `true`如果小于或者等于指定的版本对象
     */
    lte(target)
    {
        return this.compareTo(target) &lt;= 0;
    }
});

TopJs.apply(Version, /** @lends TopJs.Version */ {
    /**
     * @private
     */
    releaseValueMap: {
        dev: -6,
        alpha: -5,
        a: -5,
        beta: -4,
        b: -4,
        rc: -3,
        '#': -2,
        p: -1,
        pl: -1
    },

    /**
     * 将版本号的`release`部分转换成可比较的值
     *
     * @param {object} value 获取`release`部分的可比较的值
     * @return {Object}
     */
    getCompValue(value)
    {
        return !value ? 0 : (isNaN(value) ? this.releaseValueMap[value] || value : parseInt(value, 10));
    },

    /**
     * 比较两个版本
     *
     * @param {String|Number|TopJs.Version} current 当前的版本
     * @param {String|Number|TopJs.Version} target 目标比较的版本
     * @return {Boolean} 如果`current`版本数据小于`target`版本返回`-1`，如果`current`版本等于`target`
     * 返回`0`，如果`current`版本大于`target`返回`1`
     */
    compare(current, target)
    {
        let ver = current.isVersion ? current : new Version(current);
        return ver.compareTo(target);
    },

    set(version)
    {
        return version.isVersion ? version : new Version(version);
    }
});

TopJs.apply(TopJs, /** @lends TopJs */{
    /**
     * @private
     */
    lastRegisteredVersion: null,

    /**
     * 设置设置`TopJs`框架版本号
     *
     * @param {String} version 指定的版本号
     * @return {TopJs}
     */
    setVersion (version)
    {
        TopJs.lastRegisteredVersion = Version.set(version);
        return this;
    },

    /**
     * 获取框架当前版本号
     *
     * @return {TopJs.Version} TopJs版本号
     */
    getVersion ()
    {
        return TopJs.lastRegisteredVersion;
    },

    /**
     * Create a closure for deprecated code.
     * ```javascript
     *     // This means TopJs.oldMethod is only supported in 4.0.0beta and older.
     *     // If TopJs.getVersion() returns a version that is later than '4.0.0beta', for example '4.0.0RC',
     *     // the closure will not be invoked
     *     TopJs.deprecate('4.0.0beta', function() {
     *         Ext.oldMethod = Ext.newMethod;
     *
     *         ...
     *     });
     * ```
     *
     * @param {String} since The last version before it's deprecated
     * @param {Function} closure The callback function to be executed with the specified version is less than the current version
     * @param {Object} scope The execution scope (`this`) if the closure
     * @private
     */
    deprecate (since, closure, scope) 
    {
        if (Version.compare(TopJs.getVersion(), since) &lt; 1) {
            closure.call(scope);
        }
    }
});</code></pre>
        </article>
    </section>




    </div>
</div>



<script src="../js/jquery.min.js"></script>
<script src="../js/tether.min.js" crossorigin="anonymous"></script>

<script src="../js/prettify/prettify.js"></script>
<script src="../js/prettify/lang-css.js"></script>
<script>prettyPrint();</script>

<script src="../js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="../js/linenumber.js"></script>
<script src="../js/maodian.js"></script>

<script src="../js/extra.js"></script>
<script src="../js/common.js"></script>
</body>
</html>
